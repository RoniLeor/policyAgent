<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Policy Rules Report</title>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; }
        .policy { margin-bottom: 30px; }
        .rule { background: #f5f5f5; padding: 15px; margin: 10px 0; border-left: 3px solid #333; }
        .rule h3 { margin: 0 0 10px 0; }
        .meta { color: #666; font-size: 0.9em; margin-bottom: 10px; }
        pre { background: #1e1e1e; color: #ddd; padding: 10px; overflow-x: auto; font-size: 0.85em; }
    </style>
</head>
<body>
    <h1>Policy Rules Report</h1>

    <div class="policy">
        <h2>Bilateral Procedures Policy</h2>

        <div class="rule">
            <h3>Bilateral Modifier Requirement</h3>
            <div class="meta">Type: Mutual Exclusion | Confidence: High</div>
            <p>Bilateral procedures must use modifier 50 on single line, not two separate lines.</p>
            <pre>SELECT c.claim_number, cl.cpt_code, COUNT(*) as lines
FROM claim_lines cl
JOIN claims c ON cl.claim_id = c.claim_id
WHERE cl.cpt_code IN ('29806', '27447')
  AND cl.modifier1 != '50'
GROUP BY c.claim_number, cl.cpt_code, cl.date_of_service
HAVING COUNT(*) > 1;</pre>
        </div>
    </div>

    <div class="policy">
        <h2>Global Days Policy</h2>

        <div class="rule">
            <h3>E/M Within Global Period</h3>
            <div class="meta">Type: Mutual Exclusion | Confidence: High</div>
            <p>E/M within 90-day global period requires modifier 24/78/79 or injury diagnosis.</p>
            <pre>SELECT c.claim_number, cl.cpt_code, cl.date_of_service
FROM claim_lines cl
JOIN claims c ON cl.claim_id = c.claim_id
WHERE cl.cpt_code BETWEEN '99201' AND '99215'
  AND cl.modifier1 NOT IN ('24', '78', '79')
  AND EXISTS (
    SELECT 1 FROM claim_lines s
    WHERE s.claim_id = c.claim_id
    AND s.cpt_code IN ('27447', '54910')
    AND cl.date_of_service BETWEEN s.date_of_service
        AND s.date_of_service + 90
  );</pre>
        </div>

        <div class="rule">
            <h3>ED Services POS Requirement</h3>
            <div class="meta">Type: Service Not Covered | Confidence: High</div>
            <p>ED codes (99281-99285) require Place of Service 23.</p>
            <pre>SELECT c.claim_number, cl.cpt_code, cl.place_of_service
FROM claim_lines cl
JOIN claims c ON cl.claim_id = c.claim_id
WHERE cl.cpt_code IN ('99281', '99282', '99283', '99284', '99285')
  AND cl.place_of_service != '23';</pre>
        </div>
    </div>

    <div class="policy">
        <h2>Obstetrical Policy</h2>

        <div class="rule">
            <h3>Gender-Specific Services</h3>
            <div class="meta">Type: Service Not Covered | Confidence: High</div>
            <p>OB services (59000-59899) only for female patients.</p>
            <pre>SELECT c.claim_number, cl.cpt_code, p.gender
FROM claim_lines cl
JOIN claims c ON cl.claim_id = c.claim_id
JOIN patients p ON c.patient_id = p.patient_id
WHERE cl.cpt_code BETWEEN '59000' AND '59899'
  AND p.gender != 'F';</pre>
        </div>
    </div>

</body>
</html>
